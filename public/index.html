<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>오성중학교 동아리 편성 시스템</title>
    
    <!-- SEO 메타태그 -->
    <meta name="description" content="오성중학교 2025학년도 창체동아리 신청 및 편성 관리 시스템">
    <meta name="keywords" content="오성중학교, 동아리, 편성, 신청, 중학교">
    <meta name="author" content="오성중학교">
    
    <!-- 파비콘 -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🎓</text></svg>">
    
    <!-- 프로덕션용 Tailwind CSS (최적화) -->
    <style>
        /* Tailwind CSS 핵심 스타일만 포함 */
        *,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, "SF Mono", Consolas, "Liberation Mono", Menlo, monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]{display:none}
        
        /* 필수 Tailwind 유틸리티 클래스들 */
        .flex{display:flex}.grid{display:grid}.hidden{display:none}.min-h-screen{min-height:100vh}.w-full{width:100%}.max-w-md{max-width:28rem}.max-w-7xl{max-width:80rem}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.space-x-4>:not([hidden])~:not([hidden]){margin-left:1rem}.space-y-6>:not([hidden])~:not([hidden]){margin-top:1.5rem}.rounded-lg{border-radius:.5rem}.rounded-xl{border-radius:.75rem}.bg-white{background-color:#fff}.bg-gray-50{background-color:#f9fafb}.bg-blue-600{background-color:#2563eb}.bg-green-600{background-color:#16a34a}.bg-red-600{background-color:#dc2626}.bg-gradient-to-br{background-image:linear-gradient(to bottom right,var(--tw-gradient-stops))}.from-blue-50{--tw-gradient-from:#eff6ff var(--tw-gradient-to-position);--tw-gradient-to:#eff6ff00 var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.to-indigo-100{--tw-gradient-to:#e0e7ff var(--tw-gradient-to-position)}.p-4{padding:1rem}.p-6{padding:1.5rem}.p-8{padding:2rem}.px-3{padding-left:.75rem;padding-right:.75rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.px-4{padding-left:1rem;padding-right:1rem}.py-3{padding-top:.75rem;padding-bottom:.75rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.text-center{text-align:center}.text-sm{font-size:.875rem;line-height:1.25rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-2xl{font-size:1.5rem;line-height:2rem}.font-medium{font-weight:500}.font-bold{font-weight:700}.text-white{color:#fff}.text-gray-600{color:#4b5563}.text-gray-700{color:#374151}.text-gray-800{color:#1f2937}.text-blue-600{color:#2563eb}.text-red-700{color:#b91c1c}.shadow-md{box-shadow:0 4px 6px -1px #0000001a,0 2px 4px -2px #0000001a}.shadow-xl{box-shadow:0 20px 25px -5px #0000001a,0 8px 10px -6px #0000001a}.transition-colors{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.hover\:bg-blue-700:hover{background-color:#1d4ed8}.hover\:bg-green-700:hover{background-color:#15803d}.hover\:text-gray-600:hover{color:#4b5563}.focus\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}.focus\:ring-2:focus{box-shadow:var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color)}.focus\:ring-blue-500:focus{--tw-ring-color:#3b82f6}.disabled\:opacity-50:disabled{opacity:.5}.disabled\:cursor-not-allowed:disabled{cursor:not-allowed}
        
        /* 커스텀 스타일 */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans KR", "Malgun Gothic", sans-serif;
            line-height: 1.6;
        }
        
        .loading-spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .bounce-in {
            animation: bounceIn 0.6s ease-out;
        }
        
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        /* 접근성 개선 */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        .tab-active {
            background-color: white;
            color: #3b82f6;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .tab-inactive {
            color: #6b7280;
        }
        
        .border{border-width:1px}.border-gray-300{border-color:#d1d5db}.rounded{border-radius:.25rem}.mb-2{margin-bottom:.5rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.mt-4{margin-top:1rem}.mx-auto{margin-left:auto;margin-right:auto}.block{display:block}.inline-flex{display:inline-flex}.w-16{width:4rem}.h-16{height:4rem}.bg-blue-100{background-color:#dbeafe}.rounded-full{border-radius:9999px}.mr-2{margin-right:.5rem}
    </style>
    
    <!-- React & ReactDOM CDN (프로덕션) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel Standalone (프로덕션에서는 조건부 로드) -->
    <script>
        const isDev = window.location.hostname === 'localhost';
        if (isDev || !window.React) {
            document.write('<script src="https://unpkg.com/@babel/standalone/babel.min.js"><\/script>');
        }
    </script>
    
    <!-- Font Awesome (최적화된 로드) -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"></noscript>
</head>
<body class="bg-gray-50">
    <!-- Skip to content for accessibility -->
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-blue-600 text-white px-4 py-2 rounded">
        메인 콘텐츠로 바로가기
    </a>

    <!-- 메인 애플리케이션 -->
    <div id="root" role="main">
        <!-- 로딩 중일 때 표시될 기본 UI -->
        <div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center">
            <div class="text-center fade-in">
                <div class="loading-spinner mx-auto mb-4"></div>
                <p class="text-gray-600 text-lg">오성중학교 동아리 시스템</p>
                <p class="text-sm text-gray-500 mt-4">시스템을 초기화하고 있습니다...</p>
            </div>
        </div>
    </div>

    <!-- 에러 폴백 UI -->
    <div id="error-fallback" style="display: none;" class="min-h-screen bg-gray-50 flex items-center justify-center">
        <div class="max-w-md text-center bg-white p-8 rounded-xl shadow-xl">
            <div class="text-6xl mb-4">⚠️</div>
            <h1 class="text-2xl font-bold text-gray-800 mb-2">시스템 오류</h1>
            <p class="text-gray-600 mb-6">애플리케이션을 로드하는 중 문제가 발생했습니다.</p>
            <button 
                onclick="window.location.reload()" 
                class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"
            >
                페이지 새로고침
            </button>
        </div>
    </div>

    <!-- React 애플리케이션 -->
    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // 환경 설정
        const ENV = {
            isDevelopment: window.location.hostname === 'localhost',
            apiBase: window.location.origin,
            version: '1.0.1'
        };

        // API 유틸리티
        const api = {
            baseURL: ENV.apiBase,
            
            async request(endpoint, options = {}) {
                const token = localStorage.getItem('token');
                const config = {
                    headers: {
                        'Content-Type': 'application/json',
                        ...(token && { Authorization: `Bearer ${token}` })
                    },
                    ...options
                };
                
                if (config.body && typeof config.body === 'object') {
                    config.body = JSON.stringify(config.body);
                }
                
                const response = await fetch(`${this.baseURL}/api${endpoint}`, config);
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.error || `HTTP ${response.status}`);
                }
                
                return response.json();
            },
            
            login: (username, password) => 
                api.request('/login', { method: 'POST', body: { username, password } }),
            register: (student_number, name) =>
                api.request('/register', { method: 'POST', body: { student_number, name } }),
            getClubs: () => api.request('/clubs'),
            apply: (applications) => api.request('/apply', { method: 'POST', body: applications }),
            getMyApplications: () => api.request('/my-applications'),
            getAllApplications: () => api.request('/admin/applications'),
            assignClubs: () => api.request('/admin/assign-clubs', { method: 'POST' }),
            checkHealth: () => api.request('/health'),
        };

        // 로딩 컴포넌트
        const Loading = ({ message = "로딩 중..." }) => (
            <div className="flex justify-center items-center min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
                <div className="text-center fade-in">
                    <div className="loading-spinner mx-auto mb-4"></div>
                    <p className="text-gray-600 text-lg font-medium">{message}</p>
                </div>
            </div>
        );

        // 로그인 컴포넌트 (간소화된 버전)
        const LoginRegister = ({ onLogin }) => {
            const [activeTab, setActiveTab] = useState('login');
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');
            const [isAdminMode, setIsAdminMode] = useState(false);
            const [loginForm, setLoginForm] = useState({ username: '', password: '' });
            const [registerForm, setRegisterForm] = useState({ student_number: '', name: '' });

            const handleLogin = async (e) => {
                e.preventDefault();
                setLoading(true);
                setError('');

                try {
                    const result = await api.login(loginForm.username, loginForm.password);
                    localStorage.setItem('token', result.token);
                    localStorage.setItem('user', JSON.stringify(result.user));
                    onLogin(result.user);
                } catch (error) {
                    setError(error.message);
                } finally {
                    setLoading(false);
                }
            };

            const handleRegister = async (e) => {
                e.preventDefault();
                setLoading(true);
                setError('');

                try {
                    await api.register(registerForm.student_number, registerForm.name);
                    setActiveTab('login');
                    setLoginForm({
                        username: registerForm.student_number,
                        password: registerForm.student_number
                    });
                    setRegisterForm({ student_number: '', name: '' });
                } catch (error) {
                    setError(error.message);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
                    <div className="max-w-md w-full bg-white rounded-xl shadow-xl p-8 bounce-in">
                        <div className="text-center mb-8">
                            <div className="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <span className="text-2xl">🎓</span>
                            </div>
                            <h1 className="text-2xl font-bold text-gray-800">오성중학교</h1>
                            <p className="text-gray-600">동아리 편성 시스템</p>
                        </div>

                        {!isAdminMode && (
                            <div className="flex mb-6 bg-gray-50 rounded-lg p-1">
                                <button
                                    onClick={() => setActiveTab('login')}
                                    className={`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${
                                        activeTab === 'login' ? 'tab-active' : 'tab-inactive'
                                    }`}
                                >
                                    로그인
                                </button>
                                <button
                                    onClick={() => setActiveTab('register')}
                                    className={`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${
                                        activeTab === 'register' ? 'tab-active' : 'tab-inactive'
                                    }`}
                                >
                                    가입하기
                                </button>
                            </div>
                        )}

                        {(activeTab === 'login' || isAdminMode) && (
                            <form onSubmit={handleLogin} className="space-y-6">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        {isAdminMode ? '관리자 아이디' : '학번'}
                                    </label>
                                    <input
                                        type="text"
                                        value={loginForm.username}
                                        onChange={(e) => setLoginForm({...loginForm, username: e.target.value})}
                                        className="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        placeholder={isAdminMode ? '관리자 아이디' : '4자리 학번'}
                                        required
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">비밀번호</label>
                                    <input
                                        type="password"
                                        value={loginForm.password}
                                        onChange={(e) => setLoginForm({...loginForm, password: e.target.value})}
                                        className="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        placeholder={isAdminMode ? '관리자 비밀번호' : '학번과 동일'}
                                        required
                                    />
                                </div>
                                {error && (
                                    <div className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded">
                                        {error}
                                    </div>
                                )}
                                <button
                                    type="submit"
                                    disabled={loading}
                                    className="w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 disabled:opacity-50 transition-colors"
                                >
                                    {loading ? '로그인 중...' : '로그인'}
                                </button>
                            </form>
                        )}

                        {activeTab === 'register' && !isAdminMode && (
                            <form onSubmit={handleRegister} className="space-y-6">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">학번</label>
                                    <input
                                        type="text"
                                        value={registerForm.student_number}
                                        onChange={(e) => setRegisterForm({...registerForm, student_number: e.target.value})}
                                        className="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-500"
                                        placeholder="4자리 학번 (예: 1101)"
                                        maxLength="4"
                                        required
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">이름</label>
                                    <input
                                        type="text"
                                        value={registerForm.name}
                                        onChange={(e) => setRegisterForm({...registerForm, name: e.target.value})}
                                        className="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-500"
                                        placeholder="이름 (예: 홍길동)"
                                        required
                                    />
                                </div>
                                {error && (
                                    <div className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded">
                                        {error}
                                    </div>
                                )}
                                <button
                                    type="submit"
                                    disabled={loading}
                                    className="w-full bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 disabled:opacity-50 transition-colors"
                                >
                                    {loading ? '가입 중...' : '가입하기'}
                                </button>
                            </form>
                        )}

                        <div className="mt-4 text-center">
                            <button
                                onClick={() => setIsAdminMode(!isAdminMode)}
                                className="text-sm text-gray-500 hover:text-gray-600"
                            >
                                {isAdminMode ? '학생 로그인' : '관리자 로그인'}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // 메인 앱 컴포넌트
        const App = () => {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const initializeApp = async () => {
                    try {
                        // 기존 로그인 상태 확인
                        const token = localStorage.getItem('token');
                        const userData = localStorage.getItem('user');
                        
                        if (token && userData) {
                            try {
                                const parsedUser = JSON.parse(userData);
                                setUser(parsedUser);
                            } catch (error) {
                                localStorage.removeItem('token');
                                localStorage.removeItem('user');
                            }
                        }
                    } catch (error) {
                        console.error('초기화 오류:', error);
                    } finally {
                        setLoading(false);
                    }
                };

                initializeApp();
            }, []);

            const handleLogin = useCallback((userData) => {
                setUser(userData);
            }, []);

            const handleLogout = useCallback(() => {
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                setUser(null);
            }, []);

            if (loading) {
                return <Loading message="시스템 초기화 중..." />;
            }

            return (
                <main id="main-content">
                    {!user ? (
                        <LoginRegister onLogin={handleLogin} />
                    ) : (
                        <div className="min-h-screen bg-gray-50 flex items-center justify-center">
                            <div className="text-center bg-white p-8 rounded-xl shadow-xl">
                                <h1 className="text-2xl font-bold text-gray-800 mb-4">환영합니다!</h1>
                                <p className="text-gray-600 mb-6">
                                    {user.name}님 ({user.role === 'admin' ? '관리자' : '학생'})
                                </p>
                                <p className="text-sm text-gray-500 mb-6">
                                    동아리 시스템 기능이 곧 추가될 예정입니다.
                                </p>
                                <button
                                    onClick={handleLogout}
                                    className="px-6 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors"
                                >
                                    로그아웃
                                </button>
                            </div>
                        </div>
                    )}
                </main>
            );
        };

        // React 앱 렌더링
        try {
            ReactDOM.render(<App />, document.getElementById('root'));
        } catch (error) {
            console.error('렌더링 오류:', error);
            document.getElementById('root').style.display = 'none';
            document.getElementById('error-fallback').style.display = 'flex';
        }
    </script>
</body>
</html>
