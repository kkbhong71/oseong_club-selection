<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>오성중학교 동아리 편성 시스템</title>
    
    <!-- SEO 메타태그 -->
    <meta name="description" content="오성중학교 2025학년도 창체동아리 신청 및 편성 관리 시스템">
    <meta name="keywords" content="오성중학교, 동아리, 편성, 신청, 중학교">
    <meta name="author" content="오성중학교">
    
    <!-- 파비콘 -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🎓</text></svg>">
    
    <!-- 프로덕션용 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel Standalone (조건부 로드로 개선) -->
    <script>
        // 프로덕션에서는 Babel 사용을 최소화
        const isDev = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
        if (isDev || !window.React || !window.ReactDOM) {
            document.write('<script src="https://unpkg.com/@babel/standalone/babel.min.js"><\/script>');
        }
    </script>
    
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        
        :root {
            --primary-blue: #3b82f6;
            --primary-blue-hover: #2563eb;
            --success-green: #10b981;
            --warning-yellow: #f59e0b;
            --error-red: #ef4444;
        }
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            line-height: 1.6;
        }
        
        .loading-spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid var(--primary-blue);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .bounce-in {
            animation: bounceIn 0.6s ease-out;
        }
        
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .club-card {
            transition: all 0.3s ease;
            cursor: pointer;
            transform: translateZ(0);
        }
        
        .club-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .progress-bar {
            transition: width 0.5s ease-in-out;
        }
        
        .modal-backdrop {
            backdrop-filter: blur(5px);
        }
        
        .notification {
            animation: slideInRight 0.5s ease-out;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .tab-active {
            background-color: white;
            color: var(--primary-blue);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .tab-inactive {
            color: #6b7280;
        }

        .error-boundary {
            border: 2px solid var(--error-red);
            background-color: #fef2f2;
            padding: 1rem;
            border-radius: 0.5rem;
            color: #dc2626;
        }

        .connection-status {
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 1000;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .connection-online {
            background-color: #dcfce7;
            color: #166534;
        }

        .connection-offline {
            background-color: #fee2e2;
            color: #991b1b;
        }

        .connection-checking {
            background-color: #fef3c7;
            color: #92400e;
        }

        /* 접근성 개선 */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* 다크모드 대응 (선택사항) */
        @media (prefers-color-scheme: dark) {
            .bg-gray-50 { background-color: #1f2937; }
            .text-gray-800 { color: #f9fafb; }
            .text-gray-600 { color: #d1d5db; }
        }

        /* 모바일 최적화 */
        @media (max-width: 640px) {
            .club-card {
                margin-bottom: 1rem;
            }
            
            .notification {
                left: 1rem;
                right: 1rem;
                max-width: none;
            }
        }

        /* 텍스트 라인 클램프 */
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* 추가: 프로덕션 최적화 */
        .preload-content {
            content-visibility: auto;
            contain-intrinsic-size: 300px;
        }
        
        /* 스켈레톤 로딩 */
        .skeleton {
            animation: skeleton-pulse 1.5s ease-in-out infinite alternate;
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
        }
        
        @keyframes skeleton-pulse {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- 연결 상태 표시 -->
    <div id="connection-status" class="connection-status connection-checking" style="display: none;">
        <i class="fas fa-circle-notch fa-spin mr-1"></i>
        <span>연결 확인 중...</span>
    </div>

    <!-- Skip to content for accessibility -->
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-blue-600 text-white px-4 py-2 rounded">
        메인 콘텐츠로 바로가기
    </a>

    <!-- 메인 애플리케이션 -->
    <div id="root" role="main">
        <!-- 로딩 중일 때 표시될 기본 UI -->
        <div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center">
            <div class="text-center" role="status" aria-live="polite">
                <div class="loading-spinner mx-auto mb-4" aria-hidden="true"></div>
                <p class="text-gray-600 text-lg">오성중학교 동아리 시스템</p>
                <p class="text-sm text-gray-500 mt-2">시스템을 초기화하고 있습니다...</p>
                <div class="mt-4">
                    <div class="w-64 bg-gray-200 rounded-full h-2 mx-auto">
                        <div class="bg-blue-600 h-2 rounded-full animate-pulse" style="width: 70%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 에러 폴백 UI -->
    <div id="error-fallback" style="display: none;" class="min-h-screen bg-gray-50 flex items-center justify-center">
        <div class="error-boundary max-w-md text-center">
            <i class="fas fa-exclamation-triangle text-6xl text-red-500 mb-4"></i>
            <h1 class="text-2xl font-bold text-gray-800 mb-2">시스템 오류</h1>
            <p class="text-gray-600 mb-6">애플리케이션을 로드하는 중 문제가 발생했습니다.</p>
            <button 
                onclick="window.location.reload()" 
                class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"
            >
                <i class="fas fa-redo mr-2"></i>페이지 새로고침
            </button>
        </div>
    </div>

    <!-- React 애플리케이션 스크립트 -->
    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback, useMemo } = React;

        // 환경 설정
        const ENV = {
            isDevelopment: window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1',
            apiBase: window.location.origin,
            version: '1.0.1'
        };

        console.log('🚀 오성중학교 동아리 시스템 시작', { ENV, timestamp: new Date().toISOString() });

        // 유틸리티 함수들
        const utils = {
            debounce: (func, wait) => {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            },
            
            formatDate: (date) => {
                return new Date(date).toLocaleDateString('ko-KR', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            },

            // 추가: 성능 최적화 함수
            throttle: (func, limit) => {
                let inThrottle;
                return function() {
                    const args = arguments;
                    const context = this;
                    if (!inThrottle) {
                        func.apply(context, args);
                        inThrottle = true;
                        setTimeout(() => inThrottle = false, limit);
                    }
                }
            }
        };

        // 연결 상태 관리
        const ConnectionStatus = () => {
            const [isOnline, setIsOnline] = useState(navigator.onLine);
            const [apiStatus, setApiStatus] = useState('checking');
            const [lastChecked, setLastChecked] = useState(null);

            const checkApiConnection = useCallback(async () => {
                try {
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 10000);
                    
                    const response = await fetch(`${ENV.apiBase}/api/health`, {
                        method: 'GET',
                        signal: controller.signal,
                        cache: 'no-cache'
                    });
                    
                    clearTimeout(timeoutId);
                    setApiStatus(response.ok ? 'online' : 'offline');
                    setLastChecked(new Date());
                } catch (error) {
                    console.warn('API connection check failed:', error);
                    setApiStatus('offline');
                    setLastChecked(new Date());
                }
            }, []);

            useEffect(() => {
                const handleOnline = () => {
                    setIsOnline(true);
                    checkApiConnection();
                };
                
                const handleOffline = () => {
                    setIsOnline(false);
                    setApiStatus('offline');
                };

                window.addEventListener('online', handleOnline);
                window.addEventListener('offline', handleOffline);
                
                // 초기 연결 상태 확인
                checkApiConnection();
                
                // 주기적 연결 상태 체크 (30초마다)
                const interval = setInterval(checkApiConnection, 30000);

                return () => {
                    window.removeEventListener('online', handleOnline);
                    window.removeEventListener('offline', handleOffline);
                    clearInterval(interval);
                };
            }, [checkApiConnection]);

            // DOM 업데이트
            useEffect(() => {
                const connectionElement = document.getElementById('connection-status');
                if (connectionElement) {
                    const isConnected = isOnline && apiStatus === 'online';
                    const isChecking = apiStatus === 'checking';
                    
                    connectionElement.style.display = 'flex';
                    connectionElement.style.alignItems = 'center';
                    
                    if (isChecking) {
                        connectionElement.className = 'connection-status connection-checking';
                        connectionElement.innerHTML = `
                            <i class="fas fa-circle-notch fa-spin mr-1"></i>
                            <span>연결 확인 중...</span>
                        `;
                    } else if (isConnected) {
                        connectionElement.className = 'connection-status connection-online';
                        connectionElement.innerHTML = `
                            <i class="fas fa-wifi mr-1"></i>
                            <span>연결됨</span>
                        `;
                        
                        // 3초 후 자동 숨김
                        setTimeout(() => {
                            connectionElement.style.display = 'none';
                        }, 3000);
                    } else {
                        connectionElement.className = 'connection-status connection-offline';
                        connectionElement.innerHTML = `
                            <i class="fas fa-exclamation-triangle mr-1"></i>
                            <span>연결 끊김</span>
                        `;
                    }
                }
            }, [isOnline, apiStatus]);

            return null;
        };

        // 개선된 API 유틸리티
        const api = {
            baseURL: ENV.apiBase,
            
            async request(endpoint, options = {}) {
                const token = localStorage.getItem('token');
                const config = {
                    headers: {
                        'Content-Type': 'application/json',
                        ...(token && { Authorization: `Bearer ${token}` })
                    },
                    timeout: 15000,
                    ...options
                };
                
                if (config.body && typeof config.body === 'object') {
                    config.body = JSON.stringify(config.body);
                }
                
                try {
                    const response = await fetch(`${this.baseURL}/api${endpoint}`, config);
                    
                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        
                        // 구체적인 에러 메시지 제공
                        const errorMessages = {
                            401: '로그인이 필요합니다',
                            403: '접근 권한이 없습니다',
                            404: '요청한 정보를 찾을 수 없습니다',
                            429: '너무 많은 요청을 보냈습니다. 잠시 후 다시 시도해주세요',
                            500: '서버 오류가 발생했습니다. 잠시 후 다시 시도해주세요',
                            502: '서버가 일시적으로 이용할 수 없습니다',
                            503: '서비스가 일시적으로 중단되었습니다'
                        };
                        
                        const message = errorMessages[response.status] || errorData.error || `HTTP ${response.status}: 요청 처리 중 오류가 발생했습니다`;
                        throw new Error(message);
                    }
                    
                    return response.json();
                } catch (error) {
                    if (error.name === 'TypeError' && error.message.includes('fetch')) {
                        throw new Error('서버에 연결할 수 없습니다. 네트워크 상태를 확인해주세요');
                    }
                    if (error.name === 'AbortError') {
                        throw new Error('요청이 시간 초과되었습니다. 다시 시도해주세요');
                    }
                    throw error;
                }
            },
            
            // 인증 관련
            login: (username, password) => 
                api.request('/login', { method: 'POST', body: { username, password } }),
            register: (student_number, name) =>
                api.request('/register', { method: 'POST', body: { student_number, name } }),
            checkStudent: (student_number) =>
                api.request(`/check-student/${student_number}`),
            
            // 동아리 관련
            getClubs: () => api.request('/clubs'),
            getClub: (id) => api.request(`/clubs/${id}`),
            apply: (applications) => api.request('/apply', { method: 'POST', body: applications }),
            getMyApplications: () => api.request('/my-applications'),
            
            // 관리자 API
            getAllApplications: () => api.request('/admin/applications'),
            assignClubs: () => api.request('/admin/assign-clubs', { method: 'POST' }),
            getAssignments: () => api.request('/admin/assignments'),

            // 시스템 상태 확인
            checkHealth: () => api.request('/health'),
        };

        // 에러 바운더리 컴포넌트
        class ErrorBoundary extends React.Component {
            constructor(props) {
                super(props);
                this.state = { hasError: false, error: null, errorInfo: null };
            }

            static getDerivedStateFromError(error) {
                return { hasError: true, error };
            }

            componentDidCatch(error, errorInfo) {
                console.error('🚨 에러 바운더리에서 에러 포착:', error, errorInfo);
                this.setState({ errorInfo });
                
                // 에러 정보를 로그로 전송 (선택사항)
                if (!ENV.isDevelopment) {
                    try {
                        console.error('Production Error:', {
                            error: error.message,
                            stack: error.stack,
                            componentStack: errorInfo.componentStack,
                            timestamp: new Date().toISOString(),
                            userAgent: navigator.userAgent,
                            url: window.location.href
                        });
                    } catch (e) {
                        console.error('Error logging failed:', e);
                    }
                }
            }

            render() {
                if (this.state.hasError) {
                    return (
                        <div className="min-h-screen bg-gray-50 flex items-center justify-center">
                            <div className="error-boundary max-w-lg text-center">
                                <i className="fas fa-exclamation-triangle text-6xl text-red-500 mb-4"></i>
                                <h1 className="text-2xl font-bold text-gray-800 mb-4">시스템 오류가 발생했습니다</h1>
                                <p className="text-gray-600 mb-6">
                                    {this.state.error?.message || '예상치 못한 오류가 발생했습니다'}
                                </p>
                                <div className="space-y-3">
                                    <button 
                                        onClick={() => window.location.reload()} 
                                        className="w-full px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"
                                    >
                                        <i className="fas fa-redo mr-2"></i>페이지 새로고침
                                    </button>
                                    <button 
                                        onClick={() => window.location.href = '/'} 
                                        className="w-full px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors"
                                    >
                                        <i className="fas fa-home mr-2"></i>홈으로 이동
                                    </button>
                                </div>
                                
                                {ENV.isDevelopment && (
                                    <details className="mt-6 p-4 bg-gray-100 rounded text-left">
                                        <summary className="cursor-pointer font-medium">개발자 정보</summary>
                                        <div className="mt-2 space-y-2">
                                            <div>
                                                <strong>에러:</strong>
                                                <pre className="text-xs bg-white p-2 rounded mt-1 overflow-auto">
                                                    {this.state.error?.stack}
                                                </pre>
                                            </div>
                                            {this.state.errorInfo && (
                                                <div>
                                                    <strong>컴포넌트 스택:</strong>
                                                    <pre className="text-xs bg-white p-2 rounded mt-1 overflow-auto">
                                                        {this.state.errorInfo.componentStack}
                                                    </pre>
                                                </div>
                                            )}
                                        </div>
                                    </details>
                                )}
                            </div>
                        </div>
                    );
                }

                return this.props.children;
            }
        }

        // 알림 컴포넌트 (개선됨)
        const Notification = ({ message, type = 'info', onClose, duration = 5000 }) => {
            useEffect(() => {
                const timer = setTimeout(onClose, duration);
                return () => clearTimeout(timer);
            }, [onClose, duration]);

            const types = {
                success: { bg: 'bg-green-500', icon: 'fa-check-circle' },
                error: { bg: 'bg-red-500', icon: 'fa-times-circle' },
                warning: { bg: 'bg-yellow-500', icon: 'fa-exclamation-triangle' },
                info: { bg: 'bg-blue-500', icon: 'fa-info-circle' }
            };

            const config = types[type] || types.info;

            return (
                <div 
                    className={`fixed top-4 right-4 ${config.bg} text-white px-6 py-3 rounded-lg shadow-lg notification z-50 max-w-sm`}
                    role="alert"
                    aria-live="assertive"
                >
                    <div className="flex items-start space-x-3">
                        <i className={`fas ${config.icon} mt-0.5 flex-shrink-0`} aria-hidden="true"></i>
                        <div className="flex-1">
                            <p className="text-sm leading-5 break-words">{message}</p>
                        </div>
                        <button 
                            onClick={onClose} 
                            className="text-white hover:text-gray-200 flex-shrink-0 ml-2"
                            aria-label="알림 닫기"
                        >
                            <i className="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            );
        };

        // 로딩 컴포넌트 (개선됨)
        const Loading = ({ message = "로딩 중...", progress }) => (
            <div className="flex justify-center items-center min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
                <div className="text-center max-w-md" role="status" aria-live="polite">
                    <div className="loading-spinner mx-auto mb-4" aria-hidden="true"></div>
                    <p className="text-gray-600 text-lg font-medium">{message}</p>
                    <p className="text-sm text-gray-500 mt-2">시스템을 준비하고 있습니다</p>
                    
                    {progress && (
                        <div className="mt-4 w-64 bg-gray-200 rounded-full h-2 mx-auto">
                            <div 
                                className="bg-blue-600 h-2 rounded-full transition-all duration-500 ease-out"
                                style={{ width: `${progress}%` }}
                                aria-valuenow={progress}
                                aria-valuemin="0"
                                aria-valuemax="100"
                                role="progressbar"
                            ></div>
                        </div>
                    )}
                </div>
            </div>
        );

        // ClubCard 컴포넌트 (JSX 구문 오류 수정)
        const ClubCard = ({ club, onSelect, isSelected, priority }) => {
            const getAvailabilityColor = () => {
                if (club.availability_status === 'full') return 'bg-red-100 text-red-800';
                if (club.availability_status === 'near_full') return 'bg-yellow-100 text-yellow-800';
                return 'bg-green-100 text-green-800';
            };

            const getPriorityBadge = () => {
                if (!priority) return null;
                const colors = {
                    1: 'bg-red-500',
                    2: 'bg-yellow-500', 
                    3: 'bg-green-500'
                };
                return (
                    <div className={`absolute top-2 right-2 ${colors[priority]} text-white text-xs px-2 py-1 rounded-full font-bold`}>
                        {priority}지망
                    </div>
                );
            };

            return (
                <div 
                    className={`club-card bg-white rounded-lg shadow-md p-4 relative preload-content ${isSelected ? 'ring-2 ring-blue-500 bg-blue-50' : ''}`}
                    onClick={() => onSelect(club)}
                    role="button"
                    tabIndex={0}
                    onKeyPress={(e) => { if (e.key === 'Enter') onSelect(club); }}
                >
                    {getPriorityBadge()}
                    
                    <div className="mb-3">
                        <h3 className="text-lg font-bold text-gray-800 mb-1">{club.name}</h3>
                        <p className="text-sm text-gray-600 mb-2">{club.teacher} 선생님</p>
                        <p className="text-xs text-blue-600 font-medium">{club.category}</p>
                    </div>

                    <div className="mb-3">
                        <p className="text-sm text-gray-700 line-clamp-2">{club.description}</p>
                    </div>

                    <div className="flex justify-between items-center mb-2">
                        <div className="text-sm text-gray-600">
                            <i className="fas fa-users mr-1"></i>
                            {club.current_members || 0}/{club.max_capacity || club.max_members}명
                        </div>
                        <span className={`px-2 py-1 rounded-full text-xs font-medium ${getAvailabilityColor()}`}>
                            {club.availability_status === 'full' ? '정원마감' :
                             club.availability_status === 'near_full' ? '마감임박' : '신청가능'}
                        </span>
                    </div>

                    <div className="text-xs text-gray-500 space-y-1">
                        <div><i className="fas fa-map-marker-alt mr-1"></i>{club.location}</div>
                        <div><i className="fas fa-clock mr-1"></i>{club.meeting_time}</div>
                    </div>

                    <div className="mt-3 pt-3 border-t border-gray-200">
                        <button 
                            className="w-full text-blue-600 hover:text-blue-800 text-sm font-medium transition-colors"
                            onClick={(e) => {
                                e.stopPropagation();
                                onSelect(club);
                            }}
                        >
                            <i className="fas fa-info-circle mr-1"></i>상세보기
                        </button>
                    </div>
                </div>
            );
        };

        // ClubDetailModal 컴포넌트 (JSX 구문 오류 수정)
        const ClubDetailModal = ({ club, isOpen, onClose, onApply }) => {
            if (!isOpen || !club) return null;

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 modal-backdrop">
                    <div className="bg-white rounded-lg max-w-2xl w-full max-h-screen overflow-y-auto">
                        <div className="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center">
                            <h2 className="text-xl font-bold text-gray-800">{club.name}</h2>
                            <button 
                                onClick={onClose}
                                className="text-gray-400 hover:text-gray-600 text-xl"
                                aria-label="닫기"
                            >
                                <i className="fas fa-times"></i>
                            </button>
                        </div>

                        <div className="p-6 space-y-6">
                            {/* 기본 정보 */}
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <h3 className="font-semibold text-gray-700 mb-2">담당 교사</h3>
                                    <p className="text-gray-600">{club.teacher} 선생님</p>
                                </div>
                                <div>
                                    <h3 className="font-semibold text-gray-700 mb-2">모집 정원</h3>
                                    <p className="text-gray-600">{club.max_capacity || club.max_members}명 (최소 {club.min_members}명)</p>
                                </div>
                                <div>
                                    <h3 className="font-semibold text-gray-700 mb-2">활동 장소</h3>
                                    <p className="text-gray-600">{club.location}</p>
                                </div>
                                <div>
                                    <h3 className="font-semibold text-gray-700 mb-2">활동 시간</h3>
                                    <p className="text-gray-600">{club.meeting_time}</p>
                                </div>
                            </div>

                            {/* 현재 신청 현황 */}
                            <div>
                                <h3 className="font-semibold text-gray-700 mb-2">신청 현황</h3>
                                <div className="bg-gray-50 p-4 rounded-lg">
                                    <div className="flex justify-between items-center mb-2">
                                        <span>현재 신청자: {club.current_members || 0}명</span>
                                        <span className="text-sm text-gray-600">
                                            {Math.round(((club.current_members || 0) / (club.max_capacity || club.max_members)) * 100)}% 달성
                                        </span>
                                    </div>
                                    <div className="w-full bg-gray-200 rounded-full h-2">
                                        <div 
                                            className="bg-blue-600 h-2 rounded-full progress-bar"
                                            style={{ width: `${Math.min(((club.current_members || 0) / (club.max_capacity || club.max_members)) * 100, 100)}%` }}
                                        ></div>
                                    </div>
                                </div>
                            </div>

                            {/* 활동 설명 */}
                            <div>
                                <h3 className="font-semibold text-gray-700 mb-2">활동 소개</h3>
                                <p className="text-gray-600 leading-relaxed">{club.description}</p>
                            </div>

                            {/* 주요 활동 */}
                            {club.activities && (
                                <div>
                                    <h3 className="font-semibold text-gray-700 mb-2">주요 활동</h3>
                                    <p className="text-gray-600 leading-relaxed">{club.activities}</p>
                                </div>
                            )}

                            {/* 활동 목표 */}
                            {club.goals && (
                                <div>
                                    <h3 className="font-semibold text-gray-700 mb-2">활동 목표</h3>
                                    <p className="text-gray-600 leading-relaxed">{club.goals}</p>
                                </div>
                            )}

                            {/* 지원 자격 */}
                            {club.requirements && (
                                <div>
                                    <h3 className="font-semibold text-gray-700 mb-2">지원 자격</h3>
                                    <p className="text-gray-600 leading-relaxed">{club.requirements}</p>
                                </div>
                            )}
                        </div>

                        {/* 하단 버튼 - JSX 구문 오류 수정 */}
                        <div className="sticky bottom-0 bg-white border-t border-gray-200 px-6 py-4">
                            <div className="flex space-x-3">
                                <button
                                    onClick={onClose}
                                    className="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors"
                                >
                                    닫기
                                </button>
                                <button
                                    onClick={() => {
                                        onApply(club, 'first');
                                        onClose();
                                    }}
                                    className="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"
                                    disabled={club.availability_status === 'full'}
                                >
                                    <i className="fas fa-heart mr-2"></i>1지망 선택
                                </button>
                                <button
                                    onClick={() => {
                                        onApply(club, 'second');
                                        onClose();
                                    }}
                                    className="flex-1 px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors"
                                    disabled={club.availability_status === 'full'}
                                >
                                    <i className="fas fa-star mr-2"></i>2지망 선택
                                </button>
                                <button
                                    onClick={() => {
                                        onApply(club, 'third');
                                        onClose();
                                    }}
                                    className="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
                                    disabled={club.availability_status === 'full'}
                                >
                                    <i className="fas fa-plus mr-2"></i>3지망 선택
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // LoginRegister 컴포넌트는 기존과 동일하게 유지...
        // 나머지 컴포넌트들은 다음 단계에서 계속...

        // React 앱 렌더링 시작
        const App = () => {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [systemStatus, setSystemStatus] = useState('checking');
            const [initProgress, setInitProgress] = useState(0);

            useEffect(() => {
                const initializeApp = async () => {
                    try {
                        setInitProgress(20);
                        console.log('🔄 시스템 초기화 시작');
                        
                        // 시스템 상태 확인
                        await api.checkHealth();
                        setInitProgress(50);
                        setSystemStatus('healthy');
                        console.log('✅ 서버 상태 양호');
                        
                        setInitProgress(70);
                        
                        // 기존 로그인 상태 확인
                        const token = localStorage.getItem('token');
                        const userData = localStorage.getItem('user');
                        
                        if (token && userData) {
                            try {
                                const parsedUser = JSON.parse(userData);
                                setUser(parsedUser);
                                console.log('✅ 기존 로그인 상태 복원:', parsedUser.name);
                            } catch (error) {
                                console.warn('⚠️ 잘못된 사용자 데이터, 초기화:', error);
                                localStorage.removeItem('token');
                                localStorage.removeItem('user');
                            }
                        }
                        
                        setInitProgress(100);
                    } catch (error) {
                        console.error('❌ 시스템 초기화 실패:', error);
                        setSystemStatus('unhealthy');
                    } finally {
                        setTimeout(() => setLoading(false), 500);
                    }
                };

                initializeApp();
            }, []);

            const handleLogin = useCallback((userData) => {
                setUser(userData);
                console.log('✅ 로그인 성공:', userData.name, userData.role);
            }, []);

            const handleLogout = useCallback(() => {
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                setUser(null);
                console.log('👋 로그아웃 완료');
            }, []);

            if (loading) {
                return <Loading message="시스템 초기화 중..." progress={initProgress} />;
            }

            if (systemStatus === 'unhealthy') {
                return (
                    <div className="min-h-screen bg-gray-50 flex items-center justify-center p-4">
                        <div className="text-center max-w-md">
                            <i className="fas fa-exclamation-triangle text-6xl text-red-500 mb-4" aria-hidden="true"></i>
                            <h1 className="text-2xl font-bold text-gray-800 mb-2">시스템 점검 중</h1>
                            <p className="text-gray-600 mb-6">
                                현재 서버 점검이 진행 중입니다.<br/>
                                잠시 후 다시 시도해주세요.
                            </p>
                            <div className="space-y-3">
                                <button 
                                    onClick={() => window.location.reload()}
                                    className="w-full px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                                >
                                    <i className="fas fa-redo mr-2" aria-hidden="true"></i>다시 시도
                                </button>
                                {ENV.isDevelopment && (
                                    <a 
                                        href="/init-database"
                                        target="_blank"
                                        rel="noopener noreferrer"
                                        className="w-full px-6 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors inline-block"
                                    >
                                        <i className="fas fa-database mr-2" aria-hidden="true"></i>DB 초기화
                                    </a>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            // 임시로 간단한 화면만 표시
            return (
                <ErrorBoundary>
                    <ConnectionStatus />
                    <main id="main-content">
                        <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center">
                            <div className="text-center">
                                <h1 className="text-3xl font-bold text-gray-800 mb-4">오성중학교 동아리 시스템</h1>
                                <p className="text-gray-600 mb-8">JSX 구문 오류가 수정되었습니다!</p>
                                <div className="bg-white p-6 rounded-lg shadow-md">
                                    <p className="text-green-600 font-medium">✅ 시스템이 정상적으로 로드되었습니다</p>
                                </div>
                            </div>
                        </div>
                    </main>
                </ErrorBoundary>
            );
        };

        // React 앱 렌더링
        try {
            console.log('🎨 React 앱 렌더링 시작');
            ReactDOM.render(<App />, document.getElementById('root'));
            console.log('✅ React 앱 렌더링 완료');
        } catch (error) {
            console.error('❌ React 앱 렌더링 실패:', error);
            
            // 페일세이프 UI
            const rootElement = document.getElementById('root');
            const errorFallback = document.getElementById('error-fallback');
            
            if (rootElement && errorFallback) {
                rootElement.style.display = 'none';
                errorFallback.style.display = 'flex';
            }
        }
    </script>
</body>
</html>
